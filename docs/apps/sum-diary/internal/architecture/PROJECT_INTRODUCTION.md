# 숨다이어리 (Sum Diary) 프로젝트 소개

> AI 기반 감정 분석 일기 서비스 - 사용자의 일기를 깊이 이해하고 공감하는 감응(감정+응답) 플랫폼

---

## 1. 전반적인 프로젝트 소개

### 1.1 프로젝트 목적과 해결하고자 하는 문제

**숨다이어리**는 사용자가 작성한 일기를 AI가 분석하여 개인화된 감정 인사이트와 자기성찰 질문을 제공하는 웹 애플리케이션입니다.

#### 핵심 가치 제안
- **AI 기반 감정 분석**: 고도화된 자연어 처리로 정확한 감정 파악 및 해석
- **자기성찰 유도**: 깊이 있는 질문을 통한 내면 탐구 지원
- **프라이버시 우선**: 사용자 데이터 암호화 및 안전한 저장
- **데이터 시각화**: 감정 트렌드와 패턴을 직관적으로 표시
- **감응 시스템**: AI가 감정을 "명령"이 아닌 "감응요청"으로 자율적으로 해석

#### 해결하고자 하는 문제
1. **일기 작성의 단절감**: 일기 작성 후 그냥 끝나는 경험
2. **자기 이해의 한계**: 자신의 감정을 객관적으로 파악하기 어려움
3. **성찰의 부재**: 단순 기록을 넘어 깊이 있는 자기성찰 기회 부족
4. **개인정보 보호 우려**: 민감한 일기 내용의 보안 걱정

### 1.2 프로젝트 방향성

#### 철학
- **Privacy-First**: 사용자 데이터는 AES-256-GCM 암호화로 보호
- **AI 자율성**: AI가 감정을 모방이 아닌 자율적으로 해석하는 "감응 시스템"
- **사용자 중심**: 기술적 완성도보다 사용자의 감정적 경험 우선

#### 차별화 포인트
1. **이중 분석 시스템**
   - **OpenAI/Gemini**: 사용자 화면용 개인화된 감정 분석 (감응 해석, 자기성찰 질문)
   - **HUA Emotion Engine**: 정량적 감정 메트릭 (Valence-Arousal 좌표, 엔트로피, 밀도)

2. **슬립 시스템**: 감정 과몰입 패턴 감지 및 보호 장치

3. **게스트 지원**: 로그인 없이도 일기 작성 및 분석 체험 가능

### 1.3 로드맵

#### Phase 1: MVP 완성 (현재 진행 중)
- 일기 작성 및 AI 분석
- 감정 분석 결과 표시
- 게스트 사용자 지원
- 암호화 시스템 구축
- 성능 최적화 (진행 중)
- 정확도 개선 (진행 중)

#### Phase 2: 사용자 경험 개선 (1-3개월)
- [ ] 스트리밍 응답으로 체감 속도 개선
- [ ] 감정 좌표 시각화 그래프
- [ ] 주간/월간 리포트 자동 생성
- [ ] 모바일 앱 (PWA)

#### Phase 3: 기능 확장 (3-6개월)
- [ ] 음성 일기 지원
- [ ] 과거 일기 추천 ("1년 전 오늘")
- [ ] 소셜 기능 (익명 공유, 공감/응원)
- [ ] 다국어 지원

#### Phase 4: 고도화 (6-12개월)
- [ ] 개인화 모델 (사용자별 맞춤 분석)
- [ ] 실시간 학습 (사용 패턴 기반 모델 개선)
- [ ] 엔터프라이즈 버전

---

## 2. 현재까지 구축된 기능

### 2.1 사용된 모델/아키텍처

#### AI 모델
- **OpenAI GPT-5-mini**: 메인 일기 분석 (개인화된 감응 해석)
- **Google Gemini 2.5 Flash**: 대체/폴백 분석 제공
- **HUA Emotion Engine**: 정량적 감정 메트릭 분석
  - 서울대 434개 감정어 데이터 기반
  - Valence-Arousal 2D 좌표계
  - Shannon Entropy 기반 감정 복잡도 계산

#### 기술 스택

**Frontend**
- **Next.js 16.0.10**: React 프레임워크 (App Router)
- **React 19.2.1**: UI 라이브러리
- **TypeScript 5.9.3**: 타입 안전성
- **Tailwind CSS**: 유틸리티 기반 스타일링
- **@hua-labs/ui**: 내부 UI 컴포넌트 라이브러리
- **Zustand**: 상태 관리
- **NextAuth.js**: 인증 시스템

**Backend**
- **Next.js API Routes**: 서버리스 API 엔드포인트
- **Prisma ORM**: 데이터베이스 접근 계층
- **PostgreSQL**: 관계형 데이터베이스
- **AES-256-GCM**: 데이터 암호화
- **Redis** (선택사항): 캐싱 계층

**Infrastructure**
- **Vercel**: 호스팅 및 배포
- **Supabase**: PostgreSQL 호스팅

### 2.2 적용된 디자인 패턴

#### 1. 레이어드 아키텍처
```
┌─────────────────────────────────────┐
│     Presentation Layer              │
│  (Next.js Pages, React Components)  │
└─────────────────────────────────────┘
                 │
┌─────────────────────────────────────┐
│      API Layer                      │
│  (Next.js API Routes, NextAuth)    │
└─────────────────────────────────────┘
                 │
┌─────────────────────────────────────┐
│   Business Logic Layer              │
│  (Services, Encryption, Analysis)   │
└─────────────────────────────────────┘
                 │
┌─────────────────────────────────────┐
│      Data Layer                     │
│  (Prisma ORM, PostgreSQL)          │
└─────────────────────────────────────┘
```

#### 2. 서비스 레이어 패턴
- **diary-analysis-service.ts**: AI 분석 오케스트레이션
- **encryption.ts**: 암호화/복호화 로직 캡슐화
- **crisis-detection-service.ts**: 위기 감지 비즈니스 로직
- **abuse-detection.ts**: 시스템 악용 감지

#### 3. Repository 패턴 (Prisma ORM)
- 데이터베이스 접근을 Prisma 클라이언트로 추상화
- 트랜잭션 관리 및 일관성 보장

#### 4. Factory 패턴
- `getModelForProvider()`: AI 프로바이더별 모델 선택
- `createAnalysisPrompt()`: 동적 프롬프트 생성

#### 5. Strategy 패턴
- AI 프로바이더 전략 (OpenAI, Gemini, HUA Engine)
- 암호화 전략 (AES-256-GCM)

#### 6. Observer 패턴
- 비동기 작업 (HUA 감정 분석, 위기 감지)를 Promise로 분리
- 이벤트 기반 알림 시스템

### 2.3 전체 시스템 구성

#### Frontend 흐름
```
사용자 입력
    ↓
일기 작성 페이지 (/diary/write)
    ↓
로컬 검증 → API 요청 (/api/diary/create)
    ↓
로딩 화면 → 분석 완료
    ↓
분석 결과 페이지 (/diary/analysis)
    ↓
일기 상세 페이지 (/diary/[id])
```

#### Backend 흐름
```
API 요청 수신
    ↓
인증/권한 확인 (NextAuth.js)
    ↓
게스트 제한 확인 (Rate Limiting)
    ↓
데이터 암호화 (AES-256-GCM)
    ↓
AI 분석 요청 (OpenAI/Gemini)
    ↓
응답 검증 및 파싱
    ↓
슬립 계산 (과몰입 패턴 감지)
    ↓
악용 감지 (Jailbreak, 반복 요청 등)
    ↓
데이터베이스 저장 (트랜잭션)
    ↓
비동기 작업 시작
    ├─ HUA 감정 엔진 분석
    ├─ 위기 감지 서비스
    └─ 악용 알림 생성
    ↓
사용자에게 결과 반환
```

#### Database 스키마 주요 테이블

**Core Business**
- `User`: 사용자 정보 (암호화된 개인정보)
- `DiaryEntry`: 일기 데이터 (암호화된 내용)
- `AnalysisResult`: AI 분석 결과 (암호화된 분석 내용)
- `HuaEmotionAnalysis`: HUA 감정 엔진 분석 결과

**Security & Moderation**
- `CrisisAlert`: 위기 상황 감지 알림
- `AbuseAlert`: 시스템 악용 감지 알림
- `Account`: OAuth 소셜 로그인 계정
- `Session`: 세션 관리

**Operations**
- `Notification`: 사용자 알림
- `Announcement`: 공지사항
- `ApiLog`: API 호출 로그
- `ErrorLog`: 에러 로그

### 2.4 주요 기능 상세

#### 1. 일기 작성 및 분석
- **자동 임시저장**: IndexedDB 기반 오프라인 저장
- **게스트 지원**: 로그인 없이 체험 가능 (IP당 24시간당 3회 제한)
- **이중 분석**:
  - OpenAI/Gemini: 개인화된 감응 해석 (요약, 감정 흐름, 자기성찰 질문)
  - HUA Engine: 정량적 메트릭 (좌표, 엔트로피, 밀도)

#### 2. 감정 분석 시스템
- **감정의 파형**: 2-6단계 감정 변화 추적
- **오늘의 장면**: 핵심 활동 요약
- **자기성찰 질문**: 깊이 있는 내면 탐구 질문
- **감응 해석**: 부드럽고 다정한 톤의 AI 해석

#### 3. 보안 시스템
- **데이터 암호화**: AES-256-GCM (Salt + IV + Auth Tag)
- **개인정보 익명화**: AI 분석 전 자동 익명화
- **악용 감지**: 
  - Jailbreak (프롬프트 인젝션) 감지
  - Rate Limiting
  - 반복 요청 감지
- **위기 감지**: 자살/자해 위험 자동 감지 및 알림

#### 4. 슬립 시스템
- **과몰입 패턴 감지**: `momentum_tier` 높고 `affect_tier` 낮은 경우
- **윤리적 요소 분석**: 8가지 윤리 카테고리 자동 추론
- **보호 장치**: 위험 상황 시 적절한 조치 제안

#### 5. 알림 시스템
- **실시간 배지**: 읽지 않은 알림 개수 표시
- **CRUD 작업**: 알림 읽기, 삭제, 전체 읽음 처리
- **관리자 알림**: 공지사항 전파

#### 6. 관리자 대시보드
- **실제 AI API 사용량**: OpenAI/Gemini 실제 토큰 사용량 추적
- **비용 계산**: USD/KRW 자동 변환
- **시스템 모니터링**: 에러, 성능, 위기 상황 추적

#### 7. 게스트 마이그레이션
- **자동 마이그레이션**: 게스트로 작성한 일기를 로그인 후 계정으로 이전
- **다중 소스 지원**: IP 기반, localStorage 기반 게스트 ID 통합

#### 8. 소셜 로그인
- **카카오/구글 로그인**: NextAuth.js 기반
- **중복 계정 방지**: Account 테이블 기반 고유 식별

---

## 3. 앞으로 구축해야 하는 기능 목록

### 3.1 필수 기능 (MVP 완성을 위한)

#### 우선순위: 높음

**1. AI 응답 속도 최적화**
- **현재**: 35-40초 (gpt-5-mini)
- **목표**: 10-15초 체감 (스트리밍 응답)
- **방안**: 
  - OpenAI Streaming API 도입
  - Server-Sent Events (SSE) 구현
  - 프론트엔드 점진적 렌더링

**2. 감정 분석 정확도 향상**
- **현재 문제**: 감정 밀도 0.001-0.003 (너무 낮음)
- **방안**:
  - 감정 활용형 대량 추가 (621개 → 1,000개+)
  - 부분 문자열 매칭 (활용형 인식)
  - 형태소 분석기 통합 (장기)

**3. 프롬프트 최적화**
- **현재**: 400-500 토큰 (시스템 프롬프트)
- **목표**: 정확도 향상 및 토큰 최적화
- **방안**: A/B 테스트를 통한 최적 프롬프트 도출

**4. 테스트 자동화**
- [ ] Jest + React Testing Library (단위 테스트)
- [ ] Playwright (E2E 테스트)
- [ ] API 테스트 자동화

### 3.2 선택 기능 (UX 개선)

#### 우선순위: 중간

**1. 시각화 개선**
- [ ] 감정 좌표 변화 그래프 (Valence-Arousal 2D)
- [ ] 감정 파형 상세 해석 (변곡점, 변화율 표시)
- [ ] 대시보드 고도화 (주간/월간 리포트)

**2. 사용자 경험 개선**
- [ ] 모바일 앱 (PWA)
- [ ] 오프라인 모드 완전 지원
- [ ] 다크 모드 (이미 UI 라이브러리 지원)

**3. 기능 확장**
- [ ] 음성 일기 (OpenAI Whisper API)
- [ ] 일기 추천 ("1년 전 오늘", "비슷한 감정")
- [ ] 소셜 기능 (익명 공유, 공감/응원)

### 3.3 장기 계획 (고도화)

#### 우선순위: 낮음

**1. AI 고도화**
- [ ] 개인화 모델 (사용자별 맞춤 분석)
- [ ] 실시간 학습 (사용 패턴 기반 모델 개선)
- [ ] 다국어 지원 (영어 일기 분석)

**2. 인프라 개선**
- [ ] 마이크로서비스 아키텍처 전환
- [ ] Redis 캐싱 전면 도입
- [ ] 데이터베이스 샤딩 (수평 확장)

**3. 엔터프라이즈 기능**
- [ ] 팀/조직 지원
- [ ] API 공개
- [ ] 화이트라벨 솔루션

### 3.4 기술 부채 해결

**인증/권한**
- NextAuth.js 통합 완료
- [ ] 역할 기반 접근 제어 (RBAC) 완성
- [ ] 세션 관리 최적화

**성능**
- [ ] Redis 캐싱 전면 도입
- [ ] 데이터베이스 쿼리 최적화
- [ ] 이미지 최적화 (Sharp 활용)

**모니터링**
- [ ] Sentry 에러 추적 도입
- [ ] Vercel Analytics 통합
- [ ] 사용자 행동 분석

---

## 4. 향후 진행 방향과 최종 결과물

### 4.1 MVP 기준 목표 상태

**기능 완성도**
- 일기 작성 및 AI 분석
- 게스트 지원
- 보안 시스템 (암호화, 악용 감지)
- 성능 최적화 (스트리밍 응답, 진행 중)
- 정확도 개선 (감정 분석, 진행 중)

**사용자 경험**
- 반응형 디자인
- 직관적인 UI/UX
- 빠른 응답 시간 (10초 이하, 진행 중)
- 높은 분석 정확도 (진행 중)

**안정성**
- 데이터 암호화
- 에러 핸들링
- 자동화된 테스트 (진행 중)
- 모니터링 시스템 (진행 중)

### 4.2 최종적으로 사용자에게 제공하고 싶은 경험

#### 핵심 가치
**"일기 쓰는 순간, AI가 내 감정을 깊이 이해하고 따뜻하게 공감해주는 경험"**

#### 구체적 경험
1. **쉽고 편안한 일기 작성**
   - 자동 임시저장으로 작성 중단 걱정 없음
   - 게스트 모드로 로그인 없이 체험 가능

2. **깊이 있는 감정 이해**
   - AI가 단순 분석을 넘어 내 감정을 "이해"하고 해석
   - 감정 변화의 파형을 통해 패턴 파악
   - 자기성찰 질문으로 더 깊은 내면 탐구

3. **안전하고 신뢰할 수 있는 공간**
   - 모든 데이터 암호화로 프라이버시 보장
   - 위기 상황 자동 감지 및 지원
   - 악용 방지로 깨끗한 환경 유지

4. **지속적인 자기 성장**
   - 주간/월간 리포트로 감정 트렌드 파악
   - 과거 일기 추천으로 성장 과정 되돌아보기
   - 데이터 시각화로 객관적 자기 이해

#### 감성적 목표
> "사용자가 일기를 쓰는 순간, 단순 기록을 넘어 AI와의 대화를 통해 자신을 더 깊이 이해하게 되는 경험"

---

## 5. 기술적 하이라이트

### 5.1 보안 아키텍처
- **AES-256-GCM 암호화**: 군사급 암호화 표준
- **개인정보 익명화**: AI 분석 전 자동 처리
- **키 관리 시스템**: 키 로테이션 및 백업

### 5.2 AI 분석 시스템
- **이중 분석 파이프라인**: 개인화 분석 + 정량 메트릭
- **프롬프트 엔지니어링**: 감응 시스템 기반 자율적 해석
- **슬립 계산**: 과몰입 패턴 자동 감지

### 5.3 성능 최적화
- **캐싱 계층**: 메모리 → Redis → Database
- **비동기 처리**: 분석 후처리 작업 분리
- **데이터베이스 인덱싱**: 사용자별, 날짜별 최적화

---

**마지막 업데이트**: 2025-12-16
**작성자**: 개발팀
**버전**: 1.0.0

