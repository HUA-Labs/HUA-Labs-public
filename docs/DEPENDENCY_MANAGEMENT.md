# 의존성 관리 전략 및 현황

## 📋 개요

이 문서는 HUA Platform 모노레포의 의존성 관리 전략, 완료된 작업, 현재 문제점, 그리고 추후 방향성을 정리합니다.

**최종 업데이트:** 2025-01-XX  
**담당:** 개발팀

---

## ✅ 완료된 작업

### 1. 의존성 버전 통일 (2025-01-XX)

모노레포의 핵심 의존성 버전을 통일하여 일관성과 유지보수성을 향상시켰습니다.

#### 통일된 버전

| 패키지 | 이전 버전 | 통일된 버전 | 상태 |
|--------|----------|------------|------|
| **React** | 19.0.0, 19.1.0 혼재 | **19.2.0** | ✅ 완료 |
| **React DOM** | 19.0.0, 19.1.0 혼재 | **19.2.0** | ✅ 완료 |
| **Next.js** | 15.0.0, 15.4.1, 15.4.3 혼재 | **15.4.3** → **16.0.4** | ✅ 업그레이드 완료 |
| **TypeScript** | 5.9.2 | **5.9.3** | ✅ 완료 |
| **Vitest** | 4.0.13 | **4.0.14** | ✅ 완료 |
| **@types/react** | 18.3.24, 19.1.13, 19.2.2 혼재 | **19.2.7** | ✅ 완료 |
| **@types/react-dom** | 18.3.7, 19.1.9, 19.2.2 혼재 | **19.2.3** | ✅ 완료 |

#### 업데이트된 패키지

- **next-intl**: 4.3.9 → **4.5.5** (Next.js 16 지원)
- **@vitest/coverage-v8**: 4.0.13 → **4.0.14**
- **@vitest/browser-playwright**: 4.0.13 → **4.0.14**

### 2. Storybook 설정 및 버전 통일 (2025-01-XX)

Storybook 패키지들을 안정적인 버전으로 통일했습니다.

| 패키지 | 버전 | 상태 |
|--------|------|------|
| **storybook** | **8.6.14** | ✅ 통일 완료 |
| **@storybook/react-vite** | **8.6.14** | ✅ 통일 완료 |
| **@storybook/addon-essentials** | **8.6.14** | ✅ 통일 완료 |
| **@storybook/addon-interactions** | **8.6.14** | ✅ 통일 완료 |
| **@storybook/addon-a11y** | **8.6.14** | ✅ 통일 완료 |

**설정된 패키지:**
- `@hua-labs/motion`: Storybook 설정 완료
- `@hua-labs/ui`: Storybook 설정 예정

### 3. .gitignore 업데이트

Storybook 관련 빌드 출력물 및 캐시를 제외하도록 설정:
- `storybook-static/`
- `.storybook-cache/`
- `*storybook.log`

---

## ⚠️ 현재 문제점

### 1. Peer Dependency 경고

다음 패키지들이 공식적으로 Next.js 16을 지원하지 않아 경고가 발생합니다:

#### next-auth (중요)

```
✕ unmet peer next@"^12.2.5 || ^13 || ^14 || ^15": found 16.0.4
```

**영향받는 앱:**
- `apps/my-chat`: `next-auth@4.24.11`
- `apps/my-app`: `next-auth@4.24.13`

**현재 상태:**
- Peer dependency 경고는 발생하지만, 실제 동작에는 문제가 없을 가능성이 높음
- `next-auth 5.0.0-beta`는 Next.js 16을 지원하지만 아직 beta 버전

**대응 방안:**
1. 현재 상태로 테스트 진행 (권장)
2. 문제 발생 시 Next.js 15.4.3으로 롤백
3. `next-auth 5.0.0` stable 출시 대기

#### 기타 경고

다음 경고들은 기능에 큰 영향을 주지 않지만, 장기적으로 해결이 필요합니다:

- **@testing-library/react**: React 19를 공식 지원하지 않음 (14.3.1)
- **lucide-react**: React 19를 공식 지원하지 않음 (0.263.1, 0.323.0)
- **@emoji-mart/react**: React 19를 공식 지원하지 않음 (1.1.1)
- **tailwind-scrollbar**: Tailwind CSS 4.x를 요구하지만 3.x 사용 중

### 2. Deprecated 패키지

다음 패키지들은 deprecated 상태입니다:

- `@hua-labs/animation@0.1.1` (대체 방안 필요)
- `@storybook/testing-library@0.2.2` (제거 또는 업데이트 필요)
- `@types/bcryptjs@3.0.0` (최신 버전으로 업데이트 필요)
- `@types/mongoose@5.11.97` (최신 버전으로 업데이트 필요)

### 3. Storybook과 Vite 버전 불일치

```
✕ unmet peer vite@"^4.0.0 || ^5.0.0 || ^6.0.0": found 7.2.4
```

- Storybook 8.6.14는 Vite 4-6을 요구하지만, 프로젝트는 Vite 7.2.4 사용
- 현재는 동작하지만, 장기적으로 해결 필요

---

## 🎯 추후 방향성

### 단기 계획 (1-2개월)

#### 1. Next.js 16 안정화 검증

**기본 검증 (필수)**
- [ ] **빌드 테스트**: 모든 앱에서 `pnpm build` 성공 확인
  - [ ] `apps/my-api`: 빌드 성공
  - [ ] `apps/my-chat`: 빌드 성공
  - [ ] `apps/my-app`: 빌드 성공
  - [ ] `apps/hua-labs`: 빌드 성공
- [ ] **개발 서버 실행**: 모든 앱에서 `pnpm dev` 정상 실행
- [ ] **타입 체크**: `pnpm type-check` 통과 확인

**핵심 기능 검증 (중요)**
- [ ] **NextAuth 동작 확인**:
  - [ ] `my-chat`: 로그인/로그아웃 정상 동작
  - [ ] `my-app`: 로그인/로그아웃 정상 동작
  - [ ] 세션 관리 정상 동작
  - [ ] OAuth 프로바이더 (Kakao, Google) 정상 동작
- [ ] **API Routes 동작 확인**:
  - [ ] `my-api`: 주요 API 엔드포인트 정상 응답
  - [ ] `my-app`: 일기 CRUD API 정상 동작
  - [ ] `my-chat`: 채팅 API 정상 동작
- [ ] **Middleware 동작 확인**:
  - [ ] `my-app/middleware.ts`: Rate limiting 정상 동작
  - [ ] 인증 체크 정상 동작
  - [ ] IP 기반 제한 정상 동작

**Next.js 16 특화 검증**
- [ ] **Turbopack 동작 확인** (개발 모드 기본값):
  - [ ] 개발 서버 시작 속도 확인
  - [ ] Hot Module Replacement (HMR) 정상 동작
  - [ ] Fast Refresh 정상 동작
- [ ] **Server Components 동작 확인**:
  - [ ] 서버 컴포넌트 렌더링 정상
  - [ ] 클라이언트 컴포넌트 하이드레이션 정상
- [ ] **캐싱 동작 확인**:
  - [ ] 정적 페이지 캐싱 정상
  - [ ] 동적 라우트 캐싱 정상
  - [ ] API 응답 캐싱 정상
- [ ] **Metadata API 동작 확인**:
  - [ ] 메타데이터 정상 생성
  - [ ] Open Graph 태그 정상 생성
  - [ ] SEO 메타데이터 정상 생성

**성능 및 안정성 검증**
- [ ] **빌드 성능 확인**:
  - [ ] 빌드 시간 측정 (이전 버전과 비교)
  - [ ] 번들 크기 확인
  - [ ] 빌드 출력물 검증
- [ ] **런타임 성능 확인**:
  - [ ] 페이지 로딩 속도 확인
  - [ ] API 응답 시간 확인
  - [ ] 메모리 사용량 확인
- [ ] **에러 로그 확인**:
  - [ ] 콘솔 에러 없음 확인
  - [ ] 서버 에러 로그 확인
  - [ ] 클라이언트 에러 로그 확인

**롤백 준비**
- [ ] 문제 발생 시 롤백 계획 수립
- [ ] `next-auth 5.0.0` stable 출시 시 업데이트 검토

#### 2. Deprecated 패키지 정리

- [ ] `@hua-labs/animation` 대체 방안 수립
- [ ] `@storybook/testing-library` 제거 또는 업데이트
- [ ] `@types/bcryptjs`, `@types/mongoose` 최신 버전으로 업데이트

#### 3. React 19 호환성 개선

- [ ] `@testing-library/react` 최신 버전으로 업데이트 (React 19 지원 버전)
- [ ] `lucide-react` 최신 버전으로 업데이트
- [ ] `@emoji-mart/react` 최신 버전 또는 대체 방안 검토

### 중기 계획 (3-6개월)

#### 1. 메이저 업데이트 검토

다음 메이저 업데이트들은 별도 브랜치에서 테스트 후 진행:

- **Prisma 6 → 7**: 마이그레이션 가이드 확인 필요
- **Tailwind CSS 3 → 4**: 설정 변경 및 마이그레이션 필요
- **Storybook 8 → 10**: Vite 버전 호환성 확인 필요

#### 2. 의존성 정기 업데이트 프로세스

- [ ] 월 1회 패치/마이너 업데이트 자동화
- [ ] 분기별 메이저 업데이트 검토 프로세스 수립
- [ ] 의존성 보안 취약점 모니터링 설정

#### 3. 모노레포 의존성 관리 도구 도입

- [ ] `pnpm outdated` 정기 실행 및 리포트
- [ ] 의존성 버전 통일 자동화 스크립트
- [ ] CI/CD에서 의존성 버전 검증 추가

### 장기 계획 (6개월 이상)

#### 1. 의존성 최적화

- [ ] 번들 크기 분석 및 최적화
- [ ] 사용하지 않는 의존성 제거
- [ ] 트리 쉐이킹 최적화

#### 2. 보안 강화

- [ ] Dependabot 또는 Renovate 설정
- [ ] 보안 취약점 자동 스캔
- [ ] 정기적인 보안 감사

---

## 📝 의존성 업데이트 가이드라인

### 패치/마이너 업데이트

**안전하게 진행 가능:**
- TypeScript, Vitest 등 개발 도구
- React, React DOM 마이너 버전
- 기타 패치 버전

**명령어:**
```bash
# 특정 패키지 업데이트
pnpm up <package>@latest --recursive

# 모든 패치/마이너 업데이트
pnpm up --recursive --latest
```

### 메이저 업데이트

**절차:**
1. 별도 브랜치 생성 (`feat/upgrade-<package>`)
2. 마이그레이션 가이드 확인
3. 단계별 업데이트 및 테스트
4. 모든 앱에서 빌드/실행 테스트
5. 문제 발생 시 롤백
6. 검증 완료 후 메인 브랜치에 병합

**주의사항:**
- 프로덕션 앱(`my-api`, `my-chat`)은 특히 신중하게 진행
- Breaking changes 문서 반드시 확인
- 롤백 계획 수립 필수

---

## 🔗 관련 문서

- [VERSION_COMPATIBILITY.md](./VERSION_COMPATIBILITY.md) - 버전 호환성 가이드
- [ARCHITECTURE_OVERVIEW.md](./ARCHITECTURE_OVERVIEW.md) - 아키텍처 개요
- [CONTRIBUTING.md](./CONTRIBUTING.md) - 기여 가이드

---

## 📊 의존성 현황 요약

### 핵심 프레임워크

| 패키지 | 버전 | 상태 |
|--------|------|------|
| React | 19.2.0 | ✅ 통일 완료 |
| Next.js | 16.0.4 | ✅ 업그레이드 완료 (검증 필요) |
| TypeScript | 5.9.3 | ✅ 최신 패치 |

### 개발 도구

| 패키지 | 버전 | 상태 |
|--------|------|------|
| Storybook | 8.6.14 | ✅ 통일 완료 |
| Vitest | 4.0.14 | ✅ 최신 패치 |
| pnpm | 10.23.0 | ✅ 최신 |

### 주요 라이브러리

| 패키지 | 버전 | 상태 | 비고 |
|--------|------|------|------|
| next-auth | 4.24.11/13 | ⚠️ 경고 | Next.js 16 미지원 |
| next-intl | 4.5.5 | ✅ 최신 | Next.js 16 지원 |
| Prisma | 6.18.0 | ⚠️ 구버전 | 7.0.1 사용 가능 |
| Tailwind CSS | 3.4.x | ⚠️ 구버전 | 4.x 사용 가능 |

---

## 📅 업데이트 이력

- **2025-01-XX**: 의존성 버전 통일 작업 완료
- **2025-01-XX**: Next.js 16 업그레이드 완료 (검증 단계)
- **2025-01-XX**: Storybook 8.6.14 통일 완료

---

## 💡 참고사항

1. **Peer Dependency 경고**: 경고가 발생해도 실제로는 동작할 수 있습니다. 공식 지원 여부와 실제 호환성은 다를 수 있습니다.

2. **베타 서비스**: `my-api`, `my-chat`은 베타 서비스 중이므로 안정성을 최우선으로 고려합니다.

3. **모노레포 장점**: 모노레포에서는 의존성 버전을 통일하는 것이 매우 중요합니다. 이를 통해 일관성과 유지보수성을 확보할 수 있습니다.

4. **점진적 업데이트**: 메이저 업데이트는 한 번에 진행하지 말고, 단계적으로 진행하는 것이 안전합니다.

