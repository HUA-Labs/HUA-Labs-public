# HUA 감응 프리셋 시스템 개발 계획 로그

## 1. companion tone 보강

- [ ] tone-filters.yml에 companion, empathetic, warm, neutral 등 기본 감정 중심 톤 추가
- [ ] 감정 지원 시나리오 완비

## 2. 프리셋 구조 통일

- [ ] 모든 tone/mode/tier 프리셋에 `id, name, description, characteristics, use_cases` 필드 통일 적용
- [ ] LLM 파싱 최적화 및 유지보수성 강화

## 3. UX 가이드라인 필드

- [ ] `recommended_modes`, `discouraged_tiers`, `sample_phrases` 등 UX 가이드라인 필드 추가
- [ ] 프리셋 추천 로직, UI 도움말, 슬립 예방 UX에 활용

## 4. getDefaultRhythmProfile() 유틸

- [ ] 사용자 상태 기반 preset 자동 설정 구조 설계
- [ ] 다음 스프린트에 편입하여 고도화 확장 준비

## 5. 감응 품질 QA 매트릭스

- [ ] tone × mode × tier 조합별 품질 분기표 설계
- [ ] 슬립률, 몰입도, 명료도 등 감응 품질 기준 매핑
- [ ] 향후 GPT 평가-내장 evaluator와 병합 가능

## 6. 윤리 모듈 연동

- [ ] tone/tier가 트리거 조건에 포함되도록 ethics-policy-layer.yaml로 연결 설계
- [ ] system-integrity 및 slip-trigger 강화에 즉시 적용

## 7. 타입 자동화 / hot-reload 등 추가 제안

- [ ] yml → TS 타입 자동 생성 유틸(yml-to-typegen.ts) 초안 착수
- [ ] 실시간 hot-reload 및 UI 시안 기반 감응 피드백 확장 고려

## 8. 문서화 및 다음 단계

- [ ] RHYTHM-PRESET-ARCHITECTURE-NOTES.md로 문서화하여 HUA 운영 프리셋 기준에 편입 예정
- [ ] 다음 회의에서 실전 적용 및 추가 개선안 논의 진행

## 9. 보안/윤리 위반 처리 시스템

- [ ] 0.0 tier (Blocked) 상태 감지 시 자동 처리 로직 구현
  - [ ] 채팅창 UI 완전 차단
  - [ ] 세션 강제 종료
  - [ ] IP 차단 로직 연동
- [ ] 이메일 알림 시스템 구현
  - [ ] 회원정보의 이메일로 위반 내용 발송
  - [ ] 관리자 대시보드 알림 연동
  - [ ] 위반 이력 DB 저장
- [ ] 보안/윤리 위반 감지 로직
  - [ ] 실시간 감응 모니터링
  - [ ] 위반 패턴 자동 감지
  - [ ] 위험도 평가 시스템
- [ ] 복구 프로세스
  - [ ] 관리자 승인 기반 차단 해제
  - [ ] 위반 이력 관리
  - [ ] 재발 방지 정책 적용

## 10. 로그 시스템 (단계별 구현)

### Phase 1: 기본 로깅 (현재)

- [ ] 간단한 로그 파일 시스템
  - [ ] 에러 로그 (error.log)
  - [ ] 보안/윤리 위반 로그 (security.log)
  - [ ] 시스템 상태 로그 (system.log)
- [ ] 로그 로테이션
  - [ ] 일별 로그 파일 생성
  - [ ] 7일 보관 후 자동 삭제
- [ ] 기본 로그 포맷

  ```json
  {
    "timestamp": "2024-03-21T10:00:00Z",
    "level": "ERROR|WARN|INFO",
    "type": "SECURITY|SYSTEM|ERROR",
    "message": "로그 메시지",
    "metadata": {
      "tier": "0.0",
      "mode": "blocked",
      "reason": "보안 위반"
    }
  }
  ```

### Phase 2: 백엔드 구축 시 (향후)

- [ ] 로그 수집 범위 정의
  - [ ] 필수 로그 (항상 수집)
    - [ ] 시스템 상태 (tier, mode, tone 변경)
    - [ ] 에러 발생
    - [ ] 보안/윤리 위반 감지
  - [ ] 선택 로그 (사용자 동의 시)
    - [ ] 대화 내용 요약 (개인정보 제외)
    - [ ] 감응 품질 메트릭
    - [ ] 사용자 피드백

- [ ] 로그 저장소 설계
  - [ ] 실시간 로그 (Redis)
    - [ ] 최근 24시간 로그
    - [ ] 실시간 모니터링용
  - [ ] 장기 저장소 (MongoDB)
    - [ ] 24시간 이상 보관 로그
    - [ ] 분석용 집계 데이터

- [ ] 로그 보안
  - [ ] 데이터 암호화
    - [ ] 저장 시 암호화
    - [ ] 전송 시 암호화
  - [ ] 접근 제어
    - [ ] 역할 기반 접근 (RBAC)
    - [ ] 로그 조회 권한 관리
  - [ ] 개인정보 보호
    - [ ] 자동 마스킹
    - [ ] 보관 기간 관리

- [ ] 로그 분석 시스템
  - [ ] 실시간 모니터링
    - [ ] 이상 패턴 감지
    - [ ] 성능 메트릭 추적
  - [ ] 주간/월간 리포트
    - [ ] 시스템 안정성
    - [ ] 사용자 만족도
    - [ ] 보안 이슈 추이

- [ ] 로그 관리 정책
  - [ ] 보관 기간
    - [ ] 실시간 로그: 24시간
    - [ ] 일반 로그: 30일
    - [ ] 보안 로그: 1년
  - [ ] 백업 정책
    - [ ] 일일 증분 백업
    - [ ] 주간 전체 백업
  - [ ] 삭제 정책
    - [ ] 자동 삭제 스케줄
    - [ ] 수동 삭제 요청 처리

## 11. 숨일기 연동 기능 (메모)

- 숨송보다 구현이 쉬움. 챗UI에서 바로 연동 가능
- [ ] HUA 챗UI에 "숨일기로 전송" 버튼/메뉴 추가
- [ ] 사용자가 자연어로 일기 작성 → GPT 감정/상태 분석
- [ ] 분석 결과와 원문을 숨일기 DB(또는 임시 저장)에 기록
- [ ] 마이페이지에서 숨일기 목록/분석 결과 확인
- [ ] 추후 숨송, 감응 추천 등과 연동 확장

## 12. @modules 통합 및 rhythm-loader 구조 개선 (디버그)

- [ ] oracle.yml 등 개별 yml 파일명 하드코딩 제거
- [ ] tone-filters.yml, modes.yml, tiers.yml, rhythm-presets.yaml 등 통합 yml만 사용
- [ ] rhythm-loader 등에서 파일명 매핑 객체로 관리
- [ ] 디버그/에러 로그도 통일된 구조로 개선
- [ ] 불필요한 파일/코드 정리
