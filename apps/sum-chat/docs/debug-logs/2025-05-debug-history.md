# 2025-05 디버깅 히스토리 (리듬/RHYTHM)

## 1. 세션 중복 생성 문제

- **현상**: 동일한 메시지/날짜로 세션이 여러 번 생성됨
- **원인**: 세션 생성 조건이 불명확, 중복 체크 로직 미흡
- **조치**: 세션 생성 시 항상 새 세션 생성하도록 로직 단순화
- **결과**: 중복 세션 생성 방지, 세션 상태 일관성 확보

## 2. API 다중 호출(POST /api/hua) 및 자동 답변 중복

- **현상**: 최초 질문 시 자동 답변이 두 번 생성, API도 두 번 호출됨
- **원인**: useEffect와 handleSubmit에서 중복 호출, 의존성/조건 미흡
- **조치**: sessionStorage, useRef, 조건 강화로 최초 자동 답변 한 번만 실행되게 개선
- **결과**: 자동 답변/POST API 한 번만 호출, 중복 메시지 방지

## 3. 메시지/세션 상태 꼬임 및 유실

- **현상**: 메시지 유실, UI 사라짐, 새로고침 시 메시지 날아감
- **원인**: zustand store와 컴포넌트 상태 불일치, addMessage/setMessages 동기화 미흡
- **조치**: zustand store를 단일 소스로 통일, 하이드레이션 시 setMessages로 복원
- **결과**: 메시지/세션 상태 일관성, 새로고침에도 데이터 유지

## 4. 메시지 id(key) 중복 및 렌더링 오류

- **현상**: React key 중복으로 인한 렌더링 오류
- **원인**: 메시지 id 생성 방식 불일치, 중복 가능성
- **조치**: uuid로 id 생성 통일, 기존 localStorage 데이터 초기화 권고
- **결과**: key 중복 에러 해결, 렌더링 안정성 확보

## 5. 공통 유틸/데이터 로더 구조 정리

- **현상**: shared/utils 폴더 구조 혼재, import 경로 불일치
- **조치**: shared 폴더로 통합, 중복 파일 삭제, import 경로 일관화
- **결과**: 코드 가독성/유지보수성 향상

## 6. 기타

- 콘솔 로그/디버깅 코드로 상태 변화, useEffect 실행, API 호출 등 꼼꼼히 추적
- 자동 답변 useEffect가 진짜로 한 번만 실행되도록 setTimeout(0) 등 방어 코드 추가
- GPT 세션 제목 생성 시 따옴표 후처리, 모델명 통일

## 7. 동일 입력 시 기존 세션 불러오기 로직 제거

- **현상**: 사용자가 같은 말을 입력하면 기존에 같은 말로 시작된 세션을 불러오던 기능 존재
- **원인**: 중복 체크 로직이 복잡하고, 상태 꼬임/유실/중복 문제를 유발
- **조치**: 해당 로직을 제거하고, 항상 새 세션을 생성하도록 단순화
- **결과**: 세션 생성 로직이 단순해지고, 상태 일관성 및 안정성 향상

---

**최종 결과:**

- 모든 상태/동기화/중복/유실 문제 구조적으로 해결
- "오르골처럼 한 번만 정확히 동작하는" 견고한 구조 완성
- 코드 수준, 유지보수성, 확장성 모두 크게 향상

---

### 1. 핫픽스 해야할 것

- 새 세션 진입 후부터 사이드바 토클 사용 가능, 버튼 누를 시 사이드바 슬라이딩 되며 사라지고, 채팅방 헤더가 페이드로 나타나야 함(아이콘 중복으로 보이지 않기 위해서)
