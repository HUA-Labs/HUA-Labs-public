# Devlog 2026-01-13

## hua-docs 문서 사이트 개선

### 오늘의 목표
- [x] UI/디자인 개선
- [x] 기능 추가 (검색)
- [x] 문서 콘텐츠 보강
- [ ] 전체 점검 및 개선점 도출

---

## 현재 상태 점검

### 구조
- **메인 페이지**: Hero + Featured Packages + Human vs AI Docs
- **Header**: Nav + 검색(Cmd+K) + 언어/테마 토글
- **Footer**: 링크 섹션 + Built with HUA UX 배지
- **패키지 문서**: 15개 패키지 페이지 + AI docs YAML

### 기술 스택
- Next.js 16 + React 19
- @hua-labs/hua-ux (UI + Motion + i18n)
- Tailwind CSS v4
- Graphite + GitHub Actions

---

## 작업 내역

### 1. 패키지 빌드 체인 수정

빌드 순서 문제 해결:
```
@hua-labs/state → @hua-labs/i18n-core-zustand → @hua-labs/hua-ux
```

- `onStoreRehydrated` export 누락 문제 해결
- `supportedLanguages` 타입 일치 확인
- Turbopack 빌드 성공 확인

### 2. Getting Started 페이지 대대적 개선

**변경 사항:**
- 수동 설정 방법 (권장) vs CLI (알파) 탭 UI 추가
- 7단계 상세 설정 가이드:
  1. Next.js 프로젝트 생성
  2. 패키지 설치
  3. 설정 파일 생성
  4. 레이아웃 설정
  5. 번역 API 라우트 생성
  6. 번역 파일 생성
  7. 컴포넌트 사용
- CLI 알파 버전 경고 추가
- 문제 해결(Troubleshooting) 섹션 추가:
  - 하이드레이션 에러
  - 번역 로딩 문제
  - 타입 에러

**파일:** `apps/hua-docs/app/docs/getting-started/page.tsx`

### 3. 검색 기능 구현 (Cmd+K / Ctrl+K)

**새로운 파일:**
- `apps/hua-docs/components/SearchCommand.tsx`

**기능:**
- Command 컴포넌트 (@hua-labs/ui) 활용
- 페이지, 문서, 패키지 카테고리별 검색
- 한국어/영어 검색 지원
- 키보드 네비게이션 (Arrow keys, Enter, Escape)
- 실시간 필터링

**연동:**
- Header에 SearchCommand 통합

---

### 4. 패키지 데이터 중앙화

**새로운 파일:** `apps/hua-docs/constants/packages.ts`

- 모든 패키지 정보 한 곳에서 관리
- SearchCommand와 Packages 페이지에서 공유
- 헬퍼 함수: `getFeaturedPackages()`, `getOtherPackages()`, `getSearchItems()`
- 패키지 추가 시 자동으로 검색/목록에 반영

### 5. 사이드바 네비게이션 추가

**새로운 파일:**
- `components/layout/Sidebar.tsx`
- `app/docs/layout.tsx`

**기능:**
- docs/packages 타입별 사이드바
- 접을 수 있는 섹션 구조
- 현재 페이지 활성화 표시
- 카테고리별 패키지 그룹화

### 6. 가이드 페이지 구현

**새로운 페이지:**
- `/docs/guides` - 가이드 목록
- `/docs/guides/theming` - 테마/다크모드 설정
- `/docs/guides/i18n` - 다국어 설정 (실시간 데모)
- `/docs/guides/animation` - 애니메이션 훅 (재생 데모)
- `/docs/guides/project-structure` - 프로젝트 구조 (트리 뷰)
- `/docs/guides/configuration` - hua-ux.config.ts 옵션 테이블
- `/docs/guides/component-patterns` - 컴포넌트 패턴 5종 (인터랙티브)

### 8. 사이드바 UX 개선

**변경:** `components/layout/Sidebar.tsx`
```css
sticky top-16 h-[calc(100vh-4rem)] overflow-y-auto
```
- 스크롤 시 헤더 아래 고정
- 사이드바 자체 스크롤 (긴 메뉴일 때)

### 9. @hua-labs/ui exports & "use client" 문제

**문제 분석:**
```
소스 파일 (src/index.ts)
├── "use client"; ← directive 있음
└── export * from './components';

↓ tsup 번들링

dist 파일 (dist/index.mjs)
├── import { ... } from 'react'; ← directive 없음!
└── export { ... };
```

**왜 이런 일이:**
1. tsup이 ESM 번들 생성 시 code splitting 적용
2. chunk 파일들에는 `"use client"` directive가 안 붙음
3. Next.js 16 Turbopack이 이걸 Server Component로 처리하려 함
4. React hooks 발견 → 에러

**시도한 해결책들:**
- `banner: { js: '"use client";' }` → chunk에 안 붙음
- `splitting: false` → 번들 크기 증가, 여전히 안 붙음
- `minify: false` → 변화 없음

**현재 전략 (모노레포 개발용):**
```json
"exports": {
  ".": {
    "import": "./src/index.ts",   // 개발: src 직접 참조
    "require": "./dist/index.js"  // CJS: dist 참조
  }
}
```

**퍼블리시 전략 (TODO):**
```bash
# 옵션 1: post-build 스크립트
for file in dist/*.mjs dist/*.js; do
  echo '"use client";' | cat - "$file" > temp && mv temp "$file"
done

# 옵션 2: 별도 publishConfig
"publishConfig": {
  "exports": {
    ".": { "import": "./dist/index.mjs" }
  }
}

# 옵션 3: src 배포 (타입스크립트 그대로)
"files": ["src", "dist"]
```

**해결됨: post-build 스크립트**
```javascript
// scripts/add-use-client.js
const files = await readdir(DIST_DIR);
for (const file of jsFiles) {
  const content = await readFile(filePath, 'utf-8');
  if (!content.startsWith('"use client"')) {
    await writeFile(filePath, '"use client";\n' + content);
  }
}
```

package.json:
```json
"build": "tsup && tsc --emitDeclarationOnly && node scripts/add-use-client.js"
```

이제 exports가 dist를 가리켜도 정상 동작!

### 10. 외부 설치 테스트 (모노레포 밖)

**테스트 환경:**
- 새로운 Next.js 16.1.1 프로젝트 생성
- pnpm pack으로 tarball 생성 후 설치

**테스트한 패키지:**
- @hua-labs/hua-ux
- @hua-labs/ui
- @hua-labs/motion-core
- @hua-labs/i18n-core
- @hua-labs/i18n-core-zustand
- @hua-labs/state

**결과: 빌드 성공!**
```
✓ Compiled successfully in 11.2s
✓ Generating static pages (4/4)
```

**peer dependency 경고 (무시 가능):**
- pnpm의 strict 모드에서 발생
- 실제 빌드/실행에 영향 없음

### 11. AI Docs 페이지 대폭 개선

**변경 사항:**
- 4개 → 12개 YAML 문서 표시 (전체)
- 카테고리별 필터링 (전체/코어/i18n/모션/유틸)
- 검색 기능 추가
- 클립보드 복사 버튼 (각 문서별)
- 전체 다운로드 버튼
- 호버 효과 및 상태 피드백

### 12. 모바일 UX 개선

**버튼 겹침 해결:**
- Sidebar 햄버거 버튼: `bottom-4 right-4` → `bottom-6 left-4`
- ScrollToTop 버튼: `bottom-6 right-6` (기존 유지)
- 이제 서로 겹치지 않음

**폰트 크기 반응형 조정:**
```css
/* 메인 페이지 */
h1: text-5xl → text-3xl sm:text-4xl md:text-5xl lg:text-6xl
p (subtitle): text-xl → text-lg md:text-xl

/* Getting Started */
h1: text-4xl → text-2xl md:text-4xl
h2: text-2xl → text-xl md:text-2xl

/* AI Docs */
h1: text-3xl → text-2xl md:text-3xl
h2: text-2xl → text-xl md:text-2xl
```

### 13. 퍼블릭 레포 동기화 및 CI 수정

**PR #104 생성:** `01-13-fix_hua-ui_add_use-client_directive_to_dist_bundles`

**변경 사항:**
- `scripts/add-use-client.js` 복사
- `package.json` exports 및 build 스크립트 업데이트
- changeset 추가

**CI 에러 수정:**

1. peer dependency semver 문제:
   - `"@hua-labs/motion-core": "^2.0.0"` → `">=2.0.0-0"`
   - **중요**: semver에서 `>=2.0.0`은 `2.1.0-alpha.5`를 포함하지 않음!
   - prerelease 포함하려면 `>=2.0.0-0` 처럼 명시해야 함
   - `-0`은 가장 낮은 prerelease를 의미 (alpha, beta 등 모두 포함)

2. pnpm-lock.yaml 동기화:
   - frozen-lockfile 에러 해결
   - `pnpm install` 후 lockfile 커밋

3. changeset git divergence 에러:
   - `validate-pr.yml`에서 main 브랜치를 명시적으로 fetch
   - `git fetch origin main:main` 추가

### 14. hua-official 패밀리 사이트 추가

**Footer에 Family Sites 섹션 추가:**
- Sum Diary (sumdiary.com) - 감정 서비스
- HUA Docs (docs.hua-labs.com) - 테크 문서

**네이밍 컨벤션:**
- HUA 프리픽스 = 테크 서비스
- Sum 프리픽스 = 감정 서비스

### 15. 블로그/인사이트 섹션 구현

**새로운 파일:**
- `lib/blog.ts` - 블로그 유틸리티 (getAllPosts, getPostBySlug)
- `app/blog/page.tsx` - 블로그 목록 (서버 컴포넌트)
- `app/blog/[slug]/page.tsx` - 글 상세 (서버 컴포넌트)
- `app/blog/[slug]/BlogPostContent.tsx` - 마크다운 렌더러 (클라이언트)
- `app/api/blog/route.ts` - API 라우트
- `content/blog/*.mdx` - 블로그 글 저장 폴더

**기술적 특징:**
- 파일 기반 블로그 (DB 없음) - 프라이빗 레포이므로
- gray-matter로 frontmatter 파싱
- 커스텀 마크다운 파서 (sugar-high로 코드 하이라이팅)
- 한/영 타이틀, 요약 지원 (titleKo, excerptKo)
- 파일 첨부 지원 (PDF 등)

**빌드 이슈 해결:**
- `next-mdx-remote` React 19 호환 문제 → 자체 마크다운 파서로 대체
- `react-markdown` createContext 이슈 → 서버 컴포넌트로 리팩토링
- phosphor-icons SSR 이슈 → `@phosphor-icons/react/dist/ssr` 임포트 사용

**frontmatter 구조:**
```yaml
title: "글 제목"
titleKo: "한국어 제목"
date: "2026-01-13"
category: "company" | "tech" | "research" | "news"
tags: ["tag1", "tag2"]
excerpt: "영문 요약"
excerptKo: "한국어 요약"
attachments:
  - name: "파일명"
    file: "/files/filename.pdf"
```

### 16. @hua-labs/ui Logo 컴포넌트 추가

**새로운 파일:**
- `packages/hua-ui/src/advanced/Logo.tsx`
- `packages/hua-ui/src/advanced/index.ts`

**기능:**
- Symbol (엠블럼만) / Full (엠블럼+워드마크) 변형
- 크기: sm/md/lg 또는 커스텀 rem 값
- Path drawing 애니메이션 옵션
- SVG 기반 (어느 크기에서든 선명)

**PR #225 수정:**
- Logo 파일들이 untracked 상태로 누락됨 → 커밋 추가
- CI 빌드 에러 해결

### 17. Motion & Interaction 훅 추가 (@hua-labs/ui)

**새로운 파일:**
- `packages/hua-ui/src/hooks/index.ts` - 훅 모듈 엔트리
- `packages/hua-ui/src/hooks/useInView.ts` - 뷰포트 진입 감지
- `packages/hua-ui/src/hooks/useScrollProgress.ts` - 스크롤 진행률 추적
- `packages/hua-ui/src/hooks/useMouse.ts` - 마우스 위치 추적
- `packages/hua-ui/src/hooks/useWindowSize.ts` - 윈도우 크기 추적
- `packages/hua-ui/src/hooks/useReducedMotion.ts` - 접근성 모션 감소 설정 감지

**각 훅 기능:**

1. **useInView**
   - IntersectionObserver 기반 뷰포트 진입 감지
   - Options: threshold, rootMargin, triggerOnce, onChange
   - 레이지 로딩, 스크롤 애니메이션, 무한 스크롤에 활용

2. **useScrollProgress**
   - 페이지 또는 요소의 스크롤 진행률 (0-1)
   - Options: target ("page" | "element"), throttle
   - Returns: progress, scrollY, scrollX, isScrolling, direction

3. **useMouse**
   - 전역 또는 요소 기준 마우스 위치 추적
   - Options: type ("page" | "element" | "viewport"), touch, throttle
   - Returns: x, y, elementX, elementY, elementPositionX/Y (정규화), isInside, isMoving

4. **useWindowSize**
   - 윈도우 크기 및 브레이크포인트 추적
   - Options: throttle, mobileBreakpoint, tabletBreakpoint
   - Returns: width, height, isMobile, isTablet, isDesktop

5. **useReducedMotion**
   - prefers-reduced-motion 미디어 쿼리 감지
   - Returns: boolean (true = 모션 감소 선호)

**기술적 해결:**
- RefObject 타입: `React.RefObject<T | null>` 패턴 사용
- setTimeout 타이핑: `ReturnType<typeof setTimeout> | null` (크로스 플랫폼)
- null 체크 추가하여 cleanup 안전하게 처리

**문서 페이지 추가:**
- `apps/hua-docs/app/docs/hooks/page.tsx` - 훅 개요
- `apps/hua-docs/app/docs/hooks/use-in-view/page.tsx`
- `apps/hua-docs/app/docs/hooks/use-scroll-progress/page.tsx`
- `apps/hua-docs/app/docs/hooks/use-mouse/page.tsx`
- `apps/hua-docs/app/docs/hooks/use-window-size/page.tsx`
- `apps/hua-docs/app/docs/hooks/use-reduced-motion/page.tsx`

**사이드바 업데이트:**
- Hooks 섹션 추가 (docs 페이지)
- 각 훅별 아이콘 설정

### 18. hua-ux useScrollProgress 충돌 해결

**문제:**
- `@hua-labs/ui`와 `@hua-labs/motion-core` 둘 다 `useScrollProgress` export
- `hua-ux`가 `export * from` 으로 둘 다 re-export 해서 TypeScript 에러 발생

**해결:**
- `hua-ux/src/index.ts`에서 `@hua-labs/ui` 명시적 export로 변경
- `useScrollProgress`는 motion-core 버전 유지 (기존 API 호환)
- ui 버전은 `@hua-labs/ui`에서 직접 import 가능

**두 훅 차이:**
| | motion-core | ui |
|---|---|---|
| progress | 0-100 | 0-1 |
| target | page only | page \| element |
| 추가 기능 | - | direction, isScrolling, scrollX/Y |

---

## TODO

- [x] @hua-labs/ui "use client" 문제 근본 해결 (post-build 스크립트)
- [x] 모노레포 외부 설치 테스트 - 성공!
- [x] AI Docs 페이지 개선
- [x] 모바일 UX 개선 (버튼 겹침, 폰트 크기)
- [x] 남은 가이드 (project-structure, configuration, component-patterns)
- [x] /docs 메인 페이지 추가
- [x] 블로그/인사이트 섹션 기본 구현
- [x] Logo 컴포넌트 추가 (hua-ui/advanced)
- [x] Motion & Interaction 훅 추가 (useInView, useScrollProgress, useMouse, useWindowSize, useReducedMotion)
- [x] 훅 문서 페이지 추가 (/docs/hooks/*)
- [ ] Getting Started 문서 실제 기동 검증
- [ ] UI 컴포넌트 쇼케이스 페이지
- [ ] 검색 컴포넌트 패키지화 검토 (코어 vs Pro)
- [ ] 알파 태그 제거 (CI 통과 후)
- [ ] 블로그 다국어 콘텐츠 전략 결정

---

## 메모

### 검색 컴포넌트 분리 전략
- **ui (코어)**: 기본 Command, SearchInput - 이미 있음
- **ui-advanced (Pro)**: FuzzySearch, AI-powered Search, CommandPalette with shortcuts manager

### @hua-labs/ui-advanced 배포 전략

**목표:** 코드는 공개하지 않으면서 사용은 가능하게

**구현 방식:**
```
ui (코어)           → src/ 공개, dist/ 배포
ui-advanced (Pro)  → src/ 비공개, dist/만 배포
```

**package.json exports 설정:**
```json
// ui-advanced (Pro) - dist만 노출
{
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.mjs",
      "require": "./dist/index.js"
    }
  },
  "files": ["dist"]  // src 제외
}
```

**장점:**
- 타입 지원 (d.ts 파일 포함)
- Tree-shaking 지원 (ESM)
- 소스 코드 보호 (minified + bundled)

**주의사항:**
- 모노레포 개발 시: Turbopack이 src 직접 참조하도록 별도 설정 필요
- 퍼블리시 전: exports가 dist를 가리키는지 확인 필수

---

## 19. Vercel 배포 최적화

### 문제
- 패키지 변경만 있어도 모든 앱이 재배포됨
- 불필요한 빌드 시간 & 비용 발생

### 해결
`turbo-ignore`를 사용해서 변경사항 없으면 배포 스킵:

```json
// apps/hua-official/vercel.json, apps/hua-docs/vercel.json
{
  "ignoreCommand": "npx turbo-ignore"
}
```

### 동작 원리
1. `turbo-ignore`가 Turborepo 의존성 그래프 분석
2. 현재 앱에 영향 주는 변경사항 확인
3. 변경 없으면 exit 1 → Vercel이 배포 건너뜀
4. 변경 있으면 exit 0 → 배포 진행

### 적용 앱
- [x] hua-official
- [x] hua-docs
- [ ] my-chat, my-api, my-app (필요 시 추가)

