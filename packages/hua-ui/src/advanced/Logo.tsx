"use client";

import React, { useEffect } from "react";
import { merge } from "../lib/utils";
import { defaultTokens } from "../lib/styles/system/tokens";

/**
 * Logo variant 타입
 * - symbol: 엠블럼만 (기본값)
 * - full: 엠블럼 + 워드마크
 */
export type LogoVariant = "symbol" | "full";

/**
 * Logo size 타입
 * - sm, md, lg: 디자인 토큰 기반 크기
 * - number: 직접 rem 값 지정
 */
export type LogoSize = "sm" | "md" | "lg" | number;

/**
 * Logo 컴포넌트 Props
 */
export interface LogoProps extends Omit<React.HTMLAttributes<HTMLElement>, "width" | "height"> {
  /**
   * 로고 변형
   * @default "symbol"
   */
  variant?: LogoVariant;
  /**
   * 로고 크기
   * @default "md"
   */
  size?: LogoSize;
  /**
   * 애니메이션 활성화 (Path Drawing 효과)
   * @default false
   */
  animated?: boolean;
  /**
   * 추가 className
   */
  className?: string;
}

/**
 * 엠블럼 SVG Path (viewBox: 0 0 40 40)
 */
const EMBLEM_PATH =
  "M1.83795 0.0849609C3.16041 -0.269391 4.51968 0.515459 4.87408 1.83789L11.7335 27.4395L17.8184 21.3545L13.9464 6.90332C13.5921 5.58102 14.3771 4.22171 15.6993 3.86719C16.2369 3.72314 16.78 3.76987 17.2598 3.96191C17.3834 3.97561 17.5081 3.99515 17.6319 4.02832L38.1182 9.51855C39.4407 9.87293 40.2255 11.2322 39.8712 12.5547C39.5166 13.8769 38.1574 14.6619 36.835 14.3076L32.9249 13.2598L23.3487 22.8359L24.4893 27.0908C24.8437 28.4133 24.0588 29.7735 22.7364 30.1279C21.4141 30.4822 20.0548 29.6972 19.7003 28.375L19.3008 26.8838L13.3506 32.835C13.3068 32.8789 13.2592 32.9181 13.213 32.958L14.2637 36.8789C14.6179 38.2012 13.8331 39.5606 12.5108 39.915C11.1884 40.2694 9.82913 39.4845 9.47467 38.1621L0.085022 3.12109C-0.269246 1.79868 0.515578 0.439365 1.83795 0.0849609ZM21.8672 17.3057L27.3946 11.7773L19.8438 9.75488L21.8672 17.3057Z";

/**
 * 워드마크 SVG Path (viewBox: 0 0 192 37, x=40부터 시작)
 */
const WORDMARK_PATH =
  "M40.8865 0.0761719C41.2577 0.0762268 41.5614 0.211458 41.7976 0.481445C42.0507 0.751482 42.1605 1.08058 42.1267 1.46875L39.823 23.165C39.5361 25.933 40.042 28.0937 41.3416 29.6465C42.658 31.1823 44.5825 31.9502 47.114 31.9502C49.8482 31.9502 51.9919 31.1984 53.5447 29.6963C55.1142 28.1942 56.059 25.9832 56.3796 23.0635L58.6833 1.19043C58.7171 0.886659 58.8524 0.624671 59.0886 0.405273C59.3418 0.185863 59.6293 0.0761719 59.95 0.0761719H62.6589C63.0132 0.0762861 63.3085 0.211518 63.5447 0.481445C63.7978 0.751463 63.899 1.07211 63.8484 1.44336L61.4685 24.0254C61.0466 28.0084 59.5278 31.1565 56.9119 33.4688C54.2958 35.7641 50.9029 36.9121 46.7341 36.9121C42.6667 36.9121 39.5025 35.7215 37.241 33.3418C34.9794 30.962 34.0593 27.7639 34.4812 23.7471L36.8865 1.21582C36.9034 0.912022 37.0301 0.650074 37.2664 0.430664C37.5195 0.194523 37.8061 0.0761804 38.1267 0.0761719H40.8865ZM157.419 0.0761719C157.756 0.0762579 158.026 0.203032 158.228 0.456055C158.448 0.709181 158.532 1.01283 158.481 1.36719L156.502 12.4541C157.226 11.6092 158.164 10.9091 159.317 10.3545C160.667 9.71319 162.127 9.39258 163.697 9.39258C166.279 9.39262 168.355 10.3468 169.925 12.2539C171.494 14.1611 172.01 16.6756 171.469 19.7979L170.33 26.2539C169.756 29.5448 168.439 32.1437 166.381 34.0508C164.322 35.958 161.941 36.9121 159.241 36.9121C157.553 36.9121 156.102 36.5404 154.886 35.7979C153.815 35.1281 153.052 34.2874 152.597 33.2764L152.127 35.7979C152.093 36.0004 151.983 36.1857 151.798 36.3545C151.612 36.5063 151.393 36.583 151.139 36.583H148.861C148.524 36.5829 148.245 36.4561 148.026 36.2031C147.824 35.9501 147.756 35.6547 147.823 35.3174L153.899 1.0127C153.933 0.75964 154.06 0.540084 154.279 0.354492C154.498 0.168895 154.735 0.0761719 154.988 0.0761719H157.419ZM139.621 9.39258C142.203 9.39258 144.178 10.135 145.545 11.6201C146.929 13.1053 147.401 15.0885 146.963 17.5693L143.748 35.6455C143.714 35.8986 143.587 36.1181 143.368 36.3037C143.165 36.4894 142.92 36.582 142.634 36.582H140.33C140.026 36.582 139.773 36.4723 139.57 36.2529C139.368 36.0336 139.292 35.7723 139.343 35.4688L139.753 33.2568C138.858 34.4755 137.845 35.3911 136.71 36C135.562 36.6076 134.279 36.9111 132.861 36.9111C130.684 36.9111 128.987 36.27 127.772 34.9873C126.574 33.7047 126.161 31.9917 126.532 29.8486L127.09 26.6582C127.478 24.4306 128.515 22.6923 130.203 21.4434C131.891 20.1945 133.992 19.5694 136.507 19.5693C137.452 19.5693 138.389 19.6961 139.317 19.9492C140.245 20.1855 141.047 20.5316 141.722 20.9873L142.304 17.5947C142.541 16.2448 142.296 15.2156 141.57 14.5068C140.844 13.798 139.883 13.4434 138.684 13.4434C137.959 13.4434 137.3 13.5616 136.71 13.7979C136.136 14.0341 135.603 14.3547 135.114 14.7598C134.625 15.1479 134.161 15.6209 133.722 16.1777C133.301 16.7174 132.98 17.004 132.76 17.0381C132.541 17.0718 132.329 17.0293 132.127 16.9111L130.456 15.8486C130.27 15.7305 130.144 15.5527 130.077 15.3164C130.026 15.0801 130.254 14.5742 130.76 13.7979C131.284 13.0046 131.983 12.2613 132.861 11.5693C133.739 10.8605 134.726 10.3205 135.823 9.94922C136.937 9.57791 138.203 9.39258 139.621 9.39258ZM184.457 9.39258C185.587 9.39262 186.592 9.57795 187.469 9.94922C188.347 10.3205 189.064 10.8862 189.621 11.6455C190.195 12.405 190.566 13.1142 190.735 13.7725C190.921 14.4305 190.962 14.878 190.861 15.1143C190.76 15.3503 190.6 15.5104 190.381 15.5947L188.431 16.4307C188.178 16.5319 187.942 16.5489 187.722 16.4814C187.52 16.3971 187.318 16.1181 187.115 15.6455C186.912 15.173 186.659 14.7512 186.355 14.3799C186.068 13.9917 185.714 13.7127 185.292 13.5439C184.87 13.3584 184.355 13.2656 183.748 13.2656C182.803 13.2656 181.975 13.5105 181.266 14C180.574 14.4726 180.144 15.1818 179.975 16.127L179.899 16.5312C179.747 17.4931 179.866 18.2782 180.254 18.8857C180.659 19.4764 181.882 20.3124 183.925 21.3926C186.22 22.5065 187.74 23.6375 188.482 24.7852C189.225 25.9328 189.41 27.5113 189.039 29.5195L189.013 29.6963C188.558 32.2279 187.478 34.0681 185.773 35.2158C184.085 36.3466 182.119 36.9111 179.874 36.9111C178.406 36.9111 177.132 36.6671 176.052 36.1777C174.988 35.6714 174.169 34.9962 173.595 34.1523C173.038 33.3085 172.692 32.4981 172.557 31.7217C172.422 30.9453 172.422 30.4555 172.557 30.2529C172.692 30.0336 172.879 29.8822 173.115 29.7979L175.14 29.0381C175.377 28.9707 175.596 28.9791 175.799 29.0635C176.018 29.1481 176.22 29.4943 176.406 30.1016C176.609 30.6922 176.853 31.2067 177.14 31.6455C177.444 32.0843 177.857 32.4304 178.381 32.6836C178.921 32.9199 179.604 33.0381 180.431 33.0381C181.427 33.038 182.296 32.7761 183.039 32.2529C183.798 31.7297 184.263 30.9788 184.431 30L184.507 29.6709C184.692 28.6584 184.625 27.8232 184.304 27.165C183.984 26.4899 182.954 25.671 181.216 24.709C178.684 23.477 177.004 22.2532 176.177 21.0381C175.367 19.8061 175.115 18.3884 175.419 16.7852L175.545 16.1523C175.916 13.9751 176.879 12.3042 178.431 11.1396C180.001 9.97511 182.01 9.39258 184.457 9.39258ZM7.92456 0.0507812C8.3294 0.0508971 8.6588 0.202195 8.91187 0.505859C9.16494 0.792681 9.26609 1.13054 9.21558 1.51855L7.72632 15.5439H25.7742L27.2917 1.24023C27.3255 0.936656 27.4685 0.666822 27.7214 0.430664C27.9746 0.177499 28.2706 0.0507812 28.6082 0.0507812H31.4685C31.8566 0.0507849 32.1773 0.202255 32.4304 0.505859C32.7004 0.792695 32.81 1.13051 32.7595 1.51855L29.1648 35.418C29.131 35.7217 28.9872 35.9998 28.7341 36.2529C28.481 36.4892 28.1859 36.6074 27.8484 36.6074H24.9871C24.5822 36.6073 24.2528 36.4645 23.9998 36.1777C23.7467 35.874 23.6455 35.5277 23.696 35.1396L25.2371 20.6074H7.18921L5.61987 35.3926C5.60297 35.7131 5.46 35.9999 5.19019 36.2529C4.93702 36.4892 4.64953 36.6074 4.32886 36.6074H1.44312C1.05506 36.6074 0.725803 36.4645 0.455811 36.1777C0.202712 35.874 0.10156 35.5277 0.1521 35.1396L3.74683 1.26562C3.7806 0.945022 3.92439 0.666913 4.17749 0.430664C4.43063 0.177522 4.72572 0.0508046 5.06323 0.0507812H7.92456ZM81.2156 0.0507812C81.57 0.050791 81.8821 0.168994 82.1521 0.405273C82.4389 0.624614 82.6328 0.902832 82.7341 1.24023L92.4304 34.9111C92.5654 35.3837 92.5068 35.7894 92.2537 36.127C92.0005 36.4475 91.6458 36.6074 91.1902 36.6074H88.2283C87.9414 36.6074 87.6709 36.5148 87.4177 36.3291C87.1816 36.1266 87.0301 35.8986 86.9626 35.6455L84.6492 27.3418H69.4958L65.3171 35.8232C65.2159 36.0426 65.055 36.228 64.8357 36.3799C64.6163 36.5149 64.3799 36.582 64.1267 36.582H61.1394C60.6838 36.582 60.3376 36.3967 60.1013 36.0254C59.8651 35.6542 59.8652 35.2407 60.1013 34.7852L77.0632 1.0127C77.2151 0.708897 77.4185 0.472488 77.6716 0.303711C77.9416 0.135061 78.2453 0.0507812 78.5828 0.0507812H81.2156ZM111.368 0.0507812C111.773 0.050882 112.102 0.210697 112.355 0.53125C112.608 0.835009 112.692 1.18973 112.608 1.59473L107.368 31.3672H122.634C123.039 31.3672 123.359 31.511 123.595 31.7979C123.832 32.0847 123.916 32.4139 123.848 32.7852L123.368 35.418C123.334 35.7048 123.19 35.9498 122.937 36.1523C122.701 36.3548 122.439 36.4561 122.152 36.4561H102.405C102.017 36.456 101.696 36.3207 101.443 36.0508C101.207 35.7639 101.123 35.4177 101.19 35.0127L107.19 1.13965C107.241 0.869608 107.393 0.624683 107.646 0.405273C107.899 0.169049 108.177 0.0508458 108.481 0.0507812H111.368ZM136.81 23.0889C135.41 23.0889 134.254 23.384 133.343 23.9746C132.431 24.5653 131.883 25.4346 131.697 26.582L131.165 29.5947C130.979 30.6747 131.182 31.4938 131.772 32.0508C132.363 32.6077 133.283 32.8867 134.532 32.8867C136.085 32.8867 137.418 32.3295 138.532 31.2158C139.663 30.085 140.304 28.9115 140.456 27.6963L141.013 24.6328C140.676 24.1266 140.127 23.7473 139.368 23.4941C138.608 23.2241 137.755 23.0889 136.81 23.0889ZM162.052 13.8232C160.364 13.8232 158.853 14.3972 157.519 15.5449C156.186 16.6757 155.351 18.1946 155.013 20.1016L153.925 26.2793C153.604 28.085 153.857 29.5784 154.684 30.7598C155.511 31.9243 156.836 32.5068 158.659 32.5068C160.296 32.5068 161.782 31.9584 163.115 30.8613C164.465 29.7475 165.3 28.2115 165.621 26.2539L166.71 20.0762C167.047 18.1353 166.785 16.608 165.925 15.4941C165.064 14.3803 163.773 13.8233 162.052 13.8232ZM79.0134 8.02539L71.5916 23.0889H83.4636L79.2664 8.02539L79.1902 7.64551L79.0134 8.02539Z";

/**
 * size prop을 rem 값으로 변환
 */
function getSizeInRem(size: LogoSize): string {
  if (typeof size === "number") {
    return `${size}rem`;
  }

  // 디자인 토큰 기반 크기 매핑
  const sizeMap: Record<"sm" | "md" | "lg", string> = {
    sm: defaultTokens.spacing.md, // 1rem (16px)
    md: defaultTokens.spacing.lg, // 1.5rem (24px)
    lg: defaultTokens.spacing.xl, // 2rem (32px)
  };

  return sizeMap[size];
}

/**
 * Logo 컴포넌트
 *
 * HUA Labs 공식 로고 컴포넌트
 *
 * @example
 * ```tsx
 * // 기본 (엠블럼만)
 * <Logo />
 *
 * // 워드마크 포함
 * <Logo variant="full" />
 *
 * // 크기 조정
 * <Logo size="lg" />
 * <Logo size={3} /> // 3rem
 *
 * // 애니메이션
 * <Logo animated />
 * ```
 */
export function Logo({
  variant = "symbol",
  size = "md",
  animated = false,
  className,
  ...props
}: LogoProps) {
  const sizeInRem = getSizeInRem(size);

  // 애니메이션용 스타일 시트 주입 (한 번만)
  useEffect(() => {
    if (!animated) return;

    const styleId = "hua-logo-animation";
    if (document.getElementById(styleId)) return;

    const style = document.createElement("style");
    style.id = styleId;
    style.textContent = `
      @keyframes hua-logo-draw {
        from {
          stroke-dashoffset: 1000;
        }
        to {
          stroke-dashoffset: 0;
        }
      }
      @keyframes hua-logo-draw-wordmark {
        from {
          stroke-dashoffset: 2000;
        }
        to {
          stroke-dashoffset: 0;
        }
      }
      .hua-logo-path {
        stroke: currentColor;
        stroke-width: 0.5;
        fill: none;
        animation: hua-logo-draw 2s ease-in-out forwards;
      }
      .hua-logo-wordmark {
        stroke: currentColor;
        stroke-width: 0.5;
        fill: none;
        animation: hua-logo-draw-wordmark 2s ease-in-out 0.5s forwards;
      }
    `;
    document.head.appendChild(style);

    return () => {
      const existingStyle = document.getElementById(styleId);
      if (existingStyle) {
        existingStyle.remove();
      }
    };
  }, [animated]);

  // Symbol only (엠블럼만)
  if (variant === "symbol") {
    return (
      <svg
        width={sizeInRem}
        height={sizeInRem}
        viewBox="0 0 40 40"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        className={merge("text-foreground", className)}
      >
        <path
          d={EMBLEM_PATH}
          fill={animated ? "none" : "currentColor"}
          stroke={animated ? "currentColor" : "none"}
          strokeWidth={animated ? "0.5" : undefined}
          strokeLinecap="round"
          strokeLinejoin="round"
          className={animated ? "hua-logo-path" : undefined}
        />
      </svg>
    );
  }

  // Full variant (엠블럼 + 워드마크 flex 배치)
  // 워드마크 원본: 152x37, 비율 152/37 ≈ 4.1
  const wordmarkRatio = 152 / 37;

  return (
    <div
      className={merge("inline-flex items-center gap-1 flex-shrink-0 min-w-max", className)}
      {...(props as React.HTMLAttributes<HTMLDivElement>)}
    >
      {/* 엠블럼 */}
      <svg
        viewBox="0 0 40 40"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        className="flex-shrink-0"
        style={{ width: sizeInRem, height: sizeInRem }}
      >
        <path
          d={EMBLEM_PATH}
          fill={animated ? "none" : "currentColor"}
          stroke={animated ? "currentColor" : "none"}
          strokeWidth={animated ? "0.5" : undefined}
          strokeLinecap="round"
          strokeLinejoin="round"
          className={animated ? "hua-logo-path" : undefined}
        />
      </svg>
      {/* 워드마크 */}
      <svg
        viewBox="40 0 152 37"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        className="flex-shrink-0"
        style={{ 
          height: sizeInRem,
          width: `calc(${sizeInRem} * ${wordmarkRatio})`,
        }}
      >
        <path
          d={WORDMARK_PATH}
          fill={animated ? "none" : "currentColor"}
          stroke={animated ? "currentColor" : "none"}
          strokeWidth={animated ? "0.5" : undefined}
          strokeLinecap="round"
          strokeLinejoin="round"
          className={animated ? "hua-logo-wordmark" : undefined}
        />
      </svg>
    </div>
  );
}
