{"version":3,"sources":["../../src/framework/utils/ssr-translations.ts","../../src/framework/config/server.ts"],"names":["getSSRTranslations","config","translationsDir","namespaces","languageCodes","initialTranslations","translationsPath","path","lang","namespace","filePath","fs","fallbackPath","data","error","loadConfig","_getCachedConfig","defaultConfig","mergePresetWithConfig","_setCachedConfig","__require","configPath","configModule","userConfig","loadedConfig","preset","rest","createConfigFromUserConfig","validateConfig"],"mappings":"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","file":"server.mjs","sourcesContent":["/**\r\n * @hua-labs/hua/framework - SSR Translations Utils\r\n * \r\n * 서버 사이드에서 번역 파일을 로드하는 유틸리티 함수\r\n * Next.js App Router의 서버 컴포넌트에서만 사용 가능합니다.\r\n * \r\n * @example\r\n * ```tsx\r\n * // app/layout.tsx\r\n * import { getSSRTranslations } from '@hua-labs/hua/framework/server';\r\n * import huaConfig from '../hua.config';\r\n * \r\n * export default async function RootLayout({ children }) {\r\n *   const initialTranslations = await getSSRTranslations(huaUxConfig);\r\n *   \r\n *   return (\r\n *     <html>\r\n *       <body>\r\n *         <HuaProvider config={{ i18n: { initialTranslations } }}>\r\n *           {children}\r\n *         </HuaProvider>\r\n *       </body>\r\n *     </html>\r\n *   );\r\n * }\r\n * ```\r\n */\r\n\r\n// 서버 전용 모듈임을 명시 (클라이언트 번들에서 제외)\r\nimport 'server-only';\r\n\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport type { HuaConfig } from '../types';\r\n\r\n/**\r\n * SSR 번역 데이터 로드\r\n * \r\n * 서버 사이드에서 모든 지원 언어와 네임스페이스의 번역 파일을 로드합니다.\r\n * \r\n * @param config - HuaConfig 객체 (i18n 설정 포함)\r\n * @param translationsDir - 번역 파일 디렉토리 경로 (기본값: 'translations')\r\n * @returns 초기 번역 데이터 객체\r\n */\r\nexport async function getSSRTranslations(\r\n  config: HuaConfig,\r\n  translationsDir: string = 'translations'\r\n): Promise<Record<string, Record<string, Record<string, string>>>> {\r\n  if (!config.i18n) {\r\n    return {};\r\n  }\r\n\r\n  const namespaces = config.i18n.namespaces || ['common'];\r\n  const languages = config.i18n.supportedLanguages || ['ko'];\r\n  \r\n  // HuaConfig의 supportedLanguages는 string[]이므로 그대로 사용\r\n  const languageCodes: string[] = languages;\r\n\r\n  const initialTranslations: Record<\r\n    string,\r\n    Record<string, Record<string, string>>\r\n  > = {};\r\n\r\n  // 번역 파일 디렉토리 경로 (프로젝트 루트 기준)\r\n  const translationsPath = path.join(process.cwd(), translationsDir);\r\n\r\n  // 각 언어와 네임스페이스에 대해 번역 데이터 로드\r\n  for (const lang of languageCodes) {\r\n    initialTranslations[lang] = {};\r\n    \r\n    for (const namespace of namespaces) {\r\n      try {\r\n        const filePath = path.join(translationsPath, lang, `${namespace}.json`);\r\n        \r\n        if (!fs.existsSync(filePath)) {\r\n          // fallback 언어 시도\r\n          const fallbackPath = path.join(translationsPath, 'ko', `${namespace}.json`);\r\n          if (fs.existsSync(fallbackPath)) {\r\n            const data = JSON.parse(fs.readFileSync(fallbackPath, 'utf-8'));\r\n            initialTranslations[lang][namespace] = data as Record<string, string>;\r\n            continue;\r\n          }\r\n          \r\n          // 파일이 없으면 빈 객체\r\n          initialTranslations[lang][namespace] = {};\r\n          continue;\r\n        }\r\n\r\n        const data = JSON.parse(fs.readFileSync(filePath, 'utf-8'));\r\n        initialTranslations[lang][namespace] = data as Record<string, string>;\r\n      } catch (error) {\r\n        // 에러 발생 시 빈 객체 (개발 환경에서만 경고)\r\n        if (process.env.NODE_ENV === 'development') {\r\n          console.warn(\r\n            `[hua] Failed to load SSR translation for ${lang}/${namespace}:`,\r\n            error\r\n          );\r\n        }\r\n        initialTranslations[lang][namespace] = {};\r\n      }\r\n    }\r\n  }\r\n\r\n  return initialTranslations;\r\n}\r\n","/**\r\n * @hua-labs/hua/framework - Config System (Server-only)\r\n *\r\n * Server-only configuration loading.\r\n * fs 모듈을 사용하므로 서버 환경에서만 사용 가능합니다.\r\n *\r\n * ⚠️ 이 파일은 절대 클라이언트 번들에 포함되면 안 됩니다.\r\n * 반드시 서버 컴포넌트나 API 라우트에서만 import 하세요.\r\n */\r\n\r\nimport type { HuaConfig } from '../types';\r\nimport { validateConfig } from './schema';\r\nimport { mergePresetWithConfig, createConfigFromUserConfig } from './merge';\r\nimport { _getCachedConfig, _setCachedConfig } from './client';\r\n\r\n/**\r\n * Load configuration from file\r\n *\r\n * 동적으로 설정 파일을 로드합니다.\r\n *\r\n * **로드 순서**:\r\n * 1. `hua.config.ts` 시도 (TypeScript)\r\n * 2. `hua.config.js` 시도 (JavaScript)\r\n * 3. 없으면 기본값 (product preset)\r\n *\r\n * **Zero-Config**: 설정 파일이 없어도 기본값으로 동작합니다.\r\n *\r\n * **주의사항**:\r\n * - 이 함수는 Node.js 환경(빌드 타임)에서만 동작합니다.\r\n * - 런타임에서는 캐시된 설정을 사용합니다.\r\n * - **권장**: 설정 파일을 명시적으로 import하여 타입 안전성을 보장하세요.\r\n *   ```ts\r\n *   // hua.config.ts\r\n *   import { defineConfig } from '@hua-labs/hua/framework';\r\n *   export default defineConfig({ preset: 'product' });\r\n *\r\n *   // app/layout.tsx 또는 다른 서버 컴포넌트에서\r\n *   import config from '../hua.config';\r\n *   import { setConfig } from '@hua-labs/hua/framework';\r\n *   setConfig(config);\r\n *   ```\r\n *\r\n * **Fallback 용도**: 이 함수는 설정 파일이 명시적으로 import되지 않은 경우에만 사용됩니다.\r\n * 프로덕션 환경에서는 설정 파일을 명시적으로 import하는 것을 권장합니다.\r\n */\r\nexport function loadConfig(): HuaConfig {\r\n  const cachedConfig = _getCachedConfig();\r\n  if (cachedConfig) {\r\n    return cachedConfig;\r\n  }\r\n\r\n  // Node.js 환경에서만 동적 로드 시도 (서버 사이드에서만)\r\n  // 클라이언트에서는 기본 설정 반환\r\n  if (typeof window !== 'undefined') {\r\n    // 브라우저 환경: 기본 설정 반환\r\n    const defaultConfig = mergePresetWithConfig('product', {});\r\n    _setCachedConfig(defaultConfig);\r\n    return defaultConfig;\r\n  }\r\n\r\n  // Node.js 환경에서만 동적 로드 시도\r\n  if (typeof process !== 'undefined' && process.cwd && typeof require !== 'undefined') {\r\n    try {\r\n      // webpack이 분석하지 못하도록 eval 사용\r\n      // eslint-disable-next-line @typescript-eslint/no-require-imports\r\n      const dynamicRequire = eval('require') as NodeRequire;\r\n      const fs = dynamicRequire('fs') as typeof import('fs');\r\n      const path = dynamicRequire('path') as typeof import('path');\r\n      const projectRoot = process.cwd();\r\n\r\n      // 설정 파일 경로 후보\r\n      const configPaths = [\r\n        path.join(projectRoot, 'hua.config.ts'),\r\n        path.join(projectRoot, 'hua.config.js'),\r\n        path.join(projectRoot, 'hua.config.mjs'),\r\n      ];\r\n\r\n      // 첫 번째로 발견된 설정 파일 사용\r\n      for (const configPath of configPaths) {\r\n        if (fs.existsSync(configPath)) {\r\n          try {\r\n            if (typeof require !== 'undefined' && typeof require.resolve === 'function') {\r\n              try {\r\n                const configModule = dynamicRequire(configPath);\r\n                const userConfig = configModule.default || configModule;\r\n\r\n                // Preset 병합 처리\r\n                if (userConfig && typeof userConfig === 'object') {\r\n                  let loadedConfig: HuaConfig;\r\n                  if (userConfig.preset) {\r\n                    const { preset, ...rest } = userConfig;\r\n                    loadedConfig = mergePresetWithConfig(preset, rest);\r\n                  } else {\r\n                    loadedConfig = createConfigFromUserConfig(userConfig);\r\n                  }\r\n\r\n                  loadedConfig = validateConfig(loadedConfig);\r\n                  _setCachedConfig(loadedConfig);\r\n                  return loadedConfig;\r\n                }\r\n              } catch (requireError) {\r\n                // require 실패 (TypeScript 파일 등)\r\n                // 기본값 사용\r\n                break;\r\n              }\r\n            }\r\n          } catch (fileError) {\r\n            // 파일 읽기 실패\r\n            continue;\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      // fs, path 등이 없는 환경 (브라우저, Edge Runtime 등)\r\n      // 기본값 사용\r\n    }\r\n  }\r\n\r\n  // 기본값 (product preset)\r\n  // 설정 파일이 없거나 로드 실패 시\r\n  const defaultConfig = mergePresetWithConfig('product', {});\r\n  _setCachedConfig(defaultConfig);\r\n  return defaultConfig;\r\n}\r\n"]}